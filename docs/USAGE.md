# 使用方法

この文書では、画像変換ツールの基本的な使い方と主要な機能の使用方法について説明します。

## 目次

- [使用方法](#使用方法)
  - [目次](#目次)
  - [基本的な使い方](#基本的な使い方)
  - [コマンドラインオプション](#コマンドラインオプション)
  - [設定ファイルの使用](#設定ファイルの使用)
  - [ローカルモード](#ローカルモード)
  - [リモートモード](#リモートモード)
  - [サーバー機能](#サーバー機能)
    - [FTPサーバー](#ftpサーバー)
    - [SSHサーバー](#sshサーバー)
  - [進捗表示](#進捗表示)
  - [使用例](#使用例)
    - [基本的な変換](#基本的な変換)
    - [ドライランによる確認](#ドライランによる確認)
    - [リモートサーバーの画像を変換](#リモートサーバーの画像を変換)
    - [カスタム設定での実行](#カスタム設定での実行)
  - [ベストプラクティス](#ベストプラクティス)

## 基本的な使い方

画像変換ツールは、コマンドラインツールとして使用し、設定ファイルで詳細な動作を制御できます。

```bash
# デフォルト設定での実行
./image-converter

# カスタム設定ファイルの指定
./image-converter -config=configs/my_config.yml
```

## コマンドラインオプション

以下のコマンドラインオプションが利用可能です：

- `-config=<ファイルパス>`: 使用する設定ファイルのパスを指定します。デフォルトは `config.yml`
- `-dry-run`: ドライランモード。実際の変換は行わず、変換対象のファイルとその詳細を表示します
- `-remote`: リモートモード。SSH接続を使用して外部サーバーの画像を変換します

例：

```bash
# ドライランモードで実行
./image-converter -dry-run

# リモートモードと特定の設定ファイルを併用
./image-converter -remote -config=configs/remote_config.yml
```

## 設定ファイルの使用

設定ファイルはYAML形式で記述され、変換の詳細な挙動をカスタマイズできます。主要な設定カテゴリ：

- **remote**: リモート接続の設定
- **mode**: 実行モードの設定
- **input**: 入力ディレクトリと対象拡張子
- **conversion**: 変換設定（並列数、品質等）
- **ftp**: FTPサーバー設定
- **ssh**: SSHサーバー設定
- **logging**: ログ設定

詳細な設定オプションについては、[設定ガイド](CONFIG.md)を参照してください。

## ローカルモード

ローカルモードは、ローカルファイルシステム上の画像を変換します。

```bash
# 基本的な使用方法
./image-converter
```

ローカルモードでは、設定ファイルの `input.directory` で指定されたディレクトリ内のすべての画像が処理されます。
変換後のファイルは元のファイルと同じディレクトリに保存されます。

## リモートモード

リモートモードでは、SSH接続を使用してリモートサーバー上の画像を変換します。

```bash
# リモートモードの有効化
./image-converter -remote
```

リモートモードでは、以下の処理が行われます：

1. SSH接続を使用してリモートサーバーに接続
2. リモートサーバー上で画像ファイルを検索
3. ファイルをローカルにダウンロード
4. ローカルで変換処理を実行
5. 変換済みファイルをリモートサーバーにアップロード

詳細な設定方法については、[リモート変換ガイド](REMOTE.md)を参照してください。

## サーバー機能

本ツールには、FTPサーバーとSSHサーバーの機能が組み込まれています。これらのサーバー機能を使用すると、リモートからのアクセスが可能になります。

### FTPサーバー

```bash
# FTPサーバー機能を有効にした設定ファイルを使用
./image-converter -config=configs/ftp_enabled.yml
```

設定ファイルで `ftp.enabled` を `true` に設定することでFTPサーバーが起動します。

### SSHサーバー

```bash
# SSHサーバー機能を有効にした設定ファイルを使用
./image-converter -config=configs/ssh_enabled.yml
```

設定ファイルで `ssh.enabled` を `true` に設定することでSSHサーバーが起動します。

これらのサーバー機能の詳細な設定については、[設定ガイド](CONFIG.md)を参照してください。

## 進捗表示

変換処理中は、進捗バーが表示され、現在の処理状況を視覚的に確認できます。

```bash
変換処理: [████████████████████████████████░░░░░] 88% (440/500) 経過: 00:02:30 残り: 00:00:20
```

処理完了後には、成功/失敗の統計情報が表示されます：

```bash
処理結果: 成功: 440, 失敗: 5, スキップ: 5, 合計: 450
```

## 使用例

### 基本的な変換

```bash
# デフォルト設定での変換
./image-converter
```

### ドライランによる確認

```bash
# 実際に変換せずに対象ファイルを確認
./image-converter -dry-run
```

### リモートサーバーの画像を変換

```bash
# リモートモードでの変換
./image-converter -remote
```

### カスタム設定での実行

```bash
# 特定の設定ファイルを使用
./image-converter -config=configs/custom_quality.yml
```

## ベストプラクティス

- 大量のファイルを処理する場合は、先にドライランモードで対象ファイルを確認することをオススメします
- リモート処理では、安定したネットワーク接続を確保してください
- 高品質な変換結果が必要な場合は、設定ファイルで品質パラメーターを調整してください
- 処理速度を向上させるには、並列ワーカー数を増やします（CPUコア数に応じて調整）
- 変換後のファイルサイズと品質のバランスを確認し、設定を調整してください
